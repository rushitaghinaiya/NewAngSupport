<div class="container mt-4">
  <h4 class="fw-bold">Verify Report</h4>
  <div class="row g-3 mt-2 border rounded p-3 bg-white">
      <div class="row">
          <div class="col-md-3">
              <label class="form-label fw-semibold">Patient Name *</label>
              <input type="text" class="form-control" [value]="report?.patientName" readonly />
          </div>
          <div class="col-md-3">
              <label class="form-label fw-semibold">Patient Telephone *</label>
              <input type="text" class="form-control"  placeholder="enter telephone" />
          </div>
          <div class="col-md-3">
              <label class="form-label fw-semibold">Referred by Doctor *</label>
              <input type="text" class="form-control" placeholder="enter name" />
          </div>
          <div class="col-md-3">
              <label class="form-label fw-semibold">Lab Name *</label>
              <input type="text" class="form-control" placeholder="enter lab name" />
          </div>
      </div>
      <div class="row">
          <div class="col-md-4">
              <label class="form-label fw-semibold">Issued Date *</label>
              <input type="text" class="form-control" [value]="report?.issuedOn" readonly/>
          </div>
          <div class="col-md-4">
              <label class="form-label fw-semibold">Branch Name *</label>
              <input type="text" class="form-control" [value]="report?.branchName" placeholder="enter branch name" />
          </div>
          <div class="col-md-4">
              <label class="form-label fw-semibold">Verification Status *</label>
              <select class="form-select" [value]="report?.verificationStatus">
                  <option selected>Un-Verified</option>
                  <option>Verified</option>
              </select>
          </div>
      </div>
      <div class="col-12 text-end text-danger small">
          <em>Note: Please validate name before verifying the report.</em>
      </div>
  </div>

  <h5 class="mt-2 fw-bold">Detailed Report</h5>

  <div class="row mt-3 border rounded p-4 bg-white">
      <div class="col-lg-6">
          <div class="mb-2 d-flex align-items-center gap-2">
              <ng-container *ngIf="report && report.tests && report.tests.length > 0">
                  <select class="form-select" [(ngModel)]="selectedDivId">
                      <option *ngFor="let test of report?.tests; let i = index"
                          [id]="'divTest_' + i" [value]="'divTest_' + i">
                          {{ test.name }}
                      </option>
                  </select>
              </ng-container>
          </div>

          <div class="d-flex justify-content-between mb-2">
              <div class="d-flex gap-2">
                  <button class="btn btn-success btn-sm">Add</button>
                  <button class="btn btn-primary btn-sm" (click)="openAddTestModal()">Edit</button>
              </div>
              <div>
                  <button class="btn btn-danger btn-sm">Invalid Report</button>
              </div>
          </div>

          <ng-container *ngIf="report && report.tests && report.tests.length > 0">
              <div
                  class="divTestDivs rpt_dtls scroll"
                  *ngFor="let test of report?.tests; let i = index"
                  [id]="'divTest_' + i"
                  [class.d-none]="selectedDivId !== ('divTest_' + i)">
                  <div class="mb-10">
                      <h6 class="mb-4 fw-bold">
                          {{ test.name }}
                      </h6>

                      <div id="testfields">
                          <table class="table table-bordered">
                              <thead>
                                  <tr class="text-gray-800">
                                      <th>Tests</th>
                                      <th>Result</th>
                                      <th>Unit</th>
                                      <th>Reference Range</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  <tr *ngFor="let field of test?.testFields">
                                      <ng-container *ngIf="field.name && field.value">
                                          <td>{{ field.name }}</td>
                                          <td>{{ field.value }}</td>
                                          <td>{{ field.unit }}</td>
                                          <td>
                                              <ng-container *ngIf="field.testFieldRanges.length > 0">
                                                  <div *ngFor="let range of field.testFieldRanges">
                                                      <ng-container *ngIf="range">
                                                          <span>{{ getRangeDescription(range) }}</span><br />
                                                      </ng-container>
                                                  </div>
                                              </ng-container>
                                          </td>
                                      </ng-container>
                                  </tr>
                              </tbody>
                          </table>
                      </div>
                  </div>

                  <div class="mb-5" *ngIf="test.testNotes.length > 0">
                      <h5 class="mb-4">Notes:</h5>
                      <table class="table table-bordered">
                          <thead>
                              <tr class="text-gray-800">
                                  <th>Test Note</th>
                              </tr>
                          </thead>
                          <tbody>
                              <tr *ngFor="let note of test.testNotes; let j = index">
                                  <td>
                                      <input type="hidden" [value]="note.testNoteId" />
                                      <input type="text" class="form-control" [(ngModel)]="note.value" />
                                  </td>
                              </tr>
                          </tbody>
                      </table>
                  </div>
              </div>
          </ng-container>

          <div class="mt-3">
              <label class="form-label fw-semibold">Notes:</label>
              <textarea class="form-control" rows="1" placeholder="Test Note"></textarea>
          </div>

          <div class="mt-3 d-flex gap-2">
              <button class="btn btn-success">Verify Report</button>
              <button class="btn btn-outline-success">Save Report</button>
          </div>
      </div>

      <div class="col-lg-6 mt-4 mt-lg-0">
          <!-- Simulated PDF Viewer -->
          <div class="border rounded overflow-hidden">
              <iframe [src]="pdfUrl" width="100%" height="500px"></iframe>
          </div>
      </div>
  </div>
</div>

<!-- Modal Component (moved here for better structure) -->
<app-add-test-modal
  *ngIf="showAddTestModal"
  [reports]="reports"
  (close)="onCloseModal()">
</app-add-test-modal>
